<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>In-Network Aggregation for Shared Machine Learning Clusters | std::bodun::blog</title><meta name=title content="In-Network Aggregation for Shared Machine Learning Clusters"><meta name=description content="This [paper](https://proceedings.mlsys.org/paper/2021/file/eae27d77ca20db309e056e3d2dcd7d69-Paper.pdf) by Nadeen appeared in MLSys 2021. It presents an in-network aggregation framework called *PANAMA* for distributed ML training tasks."><meta name=keywords content="network,mlsys,paper-review,"><meta property="og:title" content="In-Network Aggregation for Shared Machine Learning Clusters"><meta property="og:description" content="This [paper](https://proceedings.mlsys.org/paper/2021/file/eae27d77ca20db309e056e3d2dcd7d69-Paper.pdf) by Nadeen appeared in MLSys 2021. It presents an in-network aggregation framework called *PANAMA* for distributed ML training tasks."><meta property="og:type" content="article"><meta property="og:url" content="https://www.bodunhu.com/blog/posts/in-network-aggregation-for-shared-machine-learning-clusters/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-31T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-14T18:31:56-06:00"><meta property="og:site_name" content="std::bodun::blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="In-Network Aggregation for Shared Machine Learning Clusters"><meta name=twitter:description content="This [paper](https://proceedings.mlsys.org/paper/2021/file/eae27d77ca20db309e056e3d2dcd7d69-Paper.pdf) by Nadeen appeared in MLSys 2021. It presents an in-network aggregation framework called *PANAMA* for distributed ML training tasks."><meta name=twitter:site content="@https://twitter.com/BodunHu"><meta itemprop=name content="In-Network Aggregation for Shared Machine Learning Clusters"><meta itemprop=description content="This [paper](https://proceedings.mlsys.org/paper/2021/file/eae27d77ca20db309e056e3d2dcd7d69-Paper.pdf) by Nadeen appeared in MLSys 2021. It presents an in-network aggregation framework called *PANAMA* for distributed ML training tasks."><meta itemprop=datePublished content="2021-08-31T00:00:00+00:00"><meta itemprop=dateModified content="2022-02-14T18:31:56-06:00"><meta itemprop=wordCount content="337"><meta itemprop=keywords content="network,mlsys,paper-review,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><a href=/blog/ class=title><h2>std::bodun::blog</h2></a><nav><a href=/blog/>Home</a>
<a href=/blog/posts/>Archive</a>
<a href=https://www.bodunhu.com/>About</a></nav></header><main><h1>In-Network Aggregation for Shared Machine Learning Clusters</h1><p><i><time datetime=2021-08-31 pubdate>31 Aug, 2021</time></i></p><content><p>This <a href=https://proceedings.mlsys.org/paper/2021/file/eae27d77ca20db309e056e3d2dcd7d69-Paper.pdf>paper</a> by Nadeen appeared in MLSys 2021. It presents an in-network aggregation framework called <em>PANAMA</em> for distributed ML training tasks. <em>PANAMA</em> has two components: (1) an in-network hardware accelerator with support for floating-point gradient aggregation; (2) a domain-specific load-balancing and congestion control protocol.</p><h2 id=motivation>Motivation</h2><p>The primary motivation behind <em>PANAMA</em> is the <em>data-parallel</em> training (in which the neural network is replicated across \(N\) worker where each worker processes a subset of the training data) demands constant local gradient exchanging at every iteration, thus creating a huge amount of traffic.</p><p>For example, for a training job with \(1000\) workers and 1 GB DNN model size requring \(1000\) iterations, the total traffic will be about 2 PB.</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/in-network-aggregation-for-shared-machine-learning-clusters/network-flow-size.png#center alt=in-network-aggregation-traffic></p><h2 id=network-design>Network Design</h2><p>The paper assumes a traditional data center multi-tier folded <a href=https://en.wikipedia.org/wiki/Clos_network>Clos topology</a>:</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/in-network-aggregation-for-shared-machine-learning-clusters/clos.png#center alt=clos-topology></p><p><em>PANAMA</em> uses multiple aggregation trees per training job to spread the traffic across multiple paths and avoid congestion hotspots. This is different to equal-cost multi-path (ECMP) protocol because the aggregation flows are typically large. Bounding such flows to a single aggregation tree will create network imbalance.</p><h2 id=congestion-control>Congestion Control</h2><p><em>PANAMA</em> uses <strong>implicit acknowledgments</strong> instead of traditional point-to-point approaches. Because each aggregated packets are constructed on the fly, one-to-one mapping between packets and the acknowledgements is unnecessary, if a worker receives aggregation results, that automatically serves as an <em>implicit</em> acknowledgement. This eliminated the need to keep a per-flow congestion state at PSwitches.</p><p>Similar to <a href>DCTCP</a>, <em>PANAMA</em> relies on ECN marks in the IP header to react to the network congestion. Since aggregation packets are created on the switch, each hardware accelerator need to perform a bitwise \(OR\) on the ECN field of received packets to mirror the traditional ECN bit.</p><h2 id=hardware-design>Hardware Design</h2><p>The design of the aggregation accelerator in <em>PANAMA</em> is straightforward: it utilized the SIMD architecture in which the gradients are partitioned across adder trees. Adder tree can operate in parallel and pack the results and sent them to the output ports. The VID fields are merely used to correct aggregation.</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/in-network-aggregation-for-shared-machine-learning-clusters/aggregater-arch.png#center alt=aggregator-arch></p><p>Overall, the workflow is really simple and illustrated below:</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/in-network-aggregation-for-shared-machine-learning-clusters/network-aggregation-workflow.png alt=network-aggregation-workflow></p></content><p><a href=https://www.bodunhu.com/blog/tags/network/>#network</a>
<a href=https://www.bodunhu.com/blog/tags/mlsys/>#mlsys</a>
<a href=https://www.bodunhu.com/blog/tags/paper-review/>#paper-review</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>