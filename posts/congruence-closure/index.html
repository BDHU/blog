<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Liste - https://www.bodunhu.com/blog/">
<title>Congruence Closure | std::bodun::blog</title>
<meta name=description content="This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I'd never forget it. But my memory starts to get blurry just after two days. So I figured I'd put things down so I don't have to watch the entire lecture again the next time I need it">
<meta property="og:title" content="Congruence Closure">
<meta property="og:description" content="This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I'd never forget it. But my memory starts to get blurry just after two days. So I figured I'd put things down so I don't have to watch the entire lecture again the next time I need it">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.bodunhu.com/blog/posts/congruence-closure/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-03-27T00:00:00+00:00">
<meta property="article:modified_time" content="2021-10-18T03:05:29-05:00">
<meta itemprop=name content="Congruence Closure">
<meta itemprop=description content="This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I'd never forget it. But my memory starts to get blurry just after two days. So I figured I'd put things down so I don't have to watch the entire lecture again the next time I need it"><meta itemprop=datePublished content="2021-03-27T00:00:00+00:00">
<meta itemprop=dateModified content="2021-10-18T03:05:29-05:00">
<meta itemprop=wordCount content="648">
<meta itemprop=keywords content="algorithm,theory,PL,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Congruence Closure">
<meta name=twitter:description content="This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I'd never forget it. But my memory starts to get blurry just after two days. So I figured I'd put things down so I don't have to watch the entire lecture again the next time I need it">
<meta name=twitter:site content="@https://twitter.com/BodunHu">
<link rel=canonical href=https://www.bodunhu.com/blog/posts/congruence-closure/>
<meta name=monetization content="$twitter.xrptipbot.com/ronaldsvilcins">
<link rel=dns-prefetch href=https://www.google-analytics.com>
<link href=https://www.google-analytics.com rel=preconnect crossorigin>
<link rel=alternate type=application/atom+xml title=std::bodun::blog href=https://www.bodunhu.com/blog/atom.xml>
<link rel=alternate type=application/json title=std::bodun::blog href=https://www.bodunhu.com/blog/feed.json>
<link rel="shortcut icon" href=/blog/images/favicon.ico type=image/x-icon>
<style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;color:#000}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}h1,h2,h3,h4,h5,strong,b{font-size:inherit;font-weight:600}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{padding:.1rem;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.hr-list-none{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}</style>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Congruence Closure","headline":"Congruence Closure","alternativeHeadline":"","description":"This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I\u0027d never forget it. But my memory starts to get blurry just after two days. So I figured I\u0027d put things down so I don\u0027t have to watch the entire lecture again the next time I need it","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.bodunhu.com\/blog\/posts\/congruence-closure\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"std::bodun::blog","copyrightYear":"2021","dateCreated":"2021-03-27T00:00:00.00Z","datePublished":"2021-03-27T00:00:00.00Z","dateModified":"2021-10-18T03:05:29.00Z","publisher":{"@type":"Organization","name":"std::bodun::blog","url":"https://www.bodunhu.com/blog/","logo":{"@type":"ImageObject","url":"https:\/\/www.bodunhu.com\/blog\/","width":"32","height":"32"}},"image":"https://www.bodunhu.com/blog/","url":"https:\/\/www.bodunhu.com\/blog\/posts\/congruence-closure\/","wordCount":"648","genre":["algorithm","theory","PL"],"keywords":["algorithm","theory","PL"]}</script>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
</head>
<body>
<a class=skip-link href=#main>Skip to main</a>
<main id=main>
<div class=content>
<header>
<p style=padding:0;margin:0><a href=/blog/><b>std::bodun::blog</b></a></p>
<ul style=padding:0;margin:0>
<li><a href=https://www.bodunhu.com/>About</a></li>
</ul>
</header>
<hr class=hr-list style=padding:0;margin:0>
<h2 class=post>Congruence Closure</h2>
<p>This is a summary of how to compute congruence closure. I implemented the algorithm to compute congruence closure and thought I&rsquo;d never forget it. But my memory starts to get blurry just after two days. So I figured I&rsquo;d put things down so I don&rsquo;t have to watch the entire lecture again the next time I need it.</p>
<h2 id=equivalence-relation>Equivalence Relation <a href=#equivalence-relation class="hash g">#</a></h2>
<p>Equivalence relation has three properties: reflexive, symmetric, and transitive.
(E.g. \(\geq\) is not an equivalence relation because it break the symmetric property. \(4 \geq 6\) does not imply that \(6 \geq 4\).
For example, a binary relation $R$ over a set $S$ meeting these three properties can be expressed as:</p>
<ul>
<li>Reflexive: $\forall s \in S.\ sRs$</li>
<li>Symmetric : $\forall s_1, s_2 \in S.\ s_1 R s_2 \rightarrow s_2 R s_1$</li>
<li>Transitive: $\forall s_1, s_2, s_3 \in S.\ s_1 R s_2 \land s_2 R s_3 \rightarrow s_1 Rs_3$</li>
</ul>
<h2 id=congruence-relation>Congruence Relation <a href=#congruence-relation class="hash g">#</a></h2>
<p>Given a set $S$ equipped with functions $F = {f_1, &mldr;, f_n}$, a relation $R$ over $S$ is a congruence relation if $R$ is an equivalence relation and for every $n$&lsquo;ary function $f \in F$ we have:</p>
<p>\[\forall \overset{\rightarrow}{s}, \overset{\rightarrow}{t}.\ \bigwedge\limits_{i=1}^{n}s_i R t_i \rightarrow f(\overset{\rightarrow}{s}) R f(\overset{\rightarrow}{t})\]</p>
<p>A counter example would be given $R(x, y)$ defined as $|x| = |y|$ on all integers. If we have $R = {2, 2}$ and $f(x) = x + 1$ (successor function), then we know it violates the equivalence relation we mentioned above</p>
<h2 id=equivalence-closure>Equivalence Closure <a href=#equivalence-closure class="hash g">#</a></h2>
<p>In short, the equivalence closure $R^E$ is the smallest equivalence relation that includes $R$.
This is illustrated through an example. Given a set $S = {a, b, c}$ and binary relation $R:{\langle a, b \rangle , \langle b, c \rangle, \langle d, d \rangle}$, $R^E$ would contain all elements extended from $R$ based on the three properties of equivalence relation.</p>
<h2 id=congruence-closure>Congruence Closure <a href=#congruence-closure class="hash g">#</a></h2>
<p>Naturally, congruence closure $R^C$ would be the smallest set that contains congruence relation $R$. What this means is $R^C$ contains $R^E$ (the equivlance closure we derived before), and any element generated from $R^E$ by a given function that produces element which also satisfies equivelance relation. For example, Given $S = {a, b, c}$ and function $f$ such that $f(a) = b$, $f(b) = c$, $f(c) = c$, the congruence closure would contain nine elments in total. First, we
would use the procedure above to generated equivalence closure. Then, because $f(a) = b$ and $f(b) = c$ due to congruence relation, we know $b = c$, now we apply the procure for generating equivalence closure again.</p>
<h2 id=algorithm-to-compute-congruence-closure>Algorithm to Compute Congruence Closure <a href=#algorithm-to-compute-congruence-closure class="hash g">#</a></h2>
<p>The high-level description of the algorithm is as following:</p>
<p>To decide satisfiability of $T_{=}$ (equality theory) formula:</p>
<p>\[F\ : \ s_1 = t_1 \land &mldr; s_m = t_m \land s_{m+1} \neq t_{m+1} \land &mldr; s_n \neq t_n\]</p>
<ol>
<li>Compute subterms and construct initial DAG (each node’s representative is itself)</li>
<li>For each $i \in [1,m]$, process equality $s_i= t_i$ as described. (Essentially, process all equiv expression first)</li>
<li>For each $i \in [m + 1,n]$, check if $Rep(s_i) =Rep(t_i)$. (Check if any nequiv expression contradicts any equiv expression)</li>
<li>If there exists some $i \in [m + 1, n]$, for which $Rep(s_i) =Rep(t_i)$, return UNSAT</li>
<li>if for all $i$, $Rep(s_i) \neq Rep(t_i)$, return SAT</li>
</ol>
<p>This is an example for illustration purposes, borrowed from Prof. <a href=https://www.cs.utexas.edu/~isil/>Dillig</a>&rsquo;s slides:</p>
<p>Given formula $F\ : \ f^3(a) = a \land f^5(a) = a \land f(a) \neq a$</p>
<p>The initial DAG would be:</p>
<p>
<p class=markdown-image style=text-align:center>
<img src=https://raw.githubusercontent.com/BDHU/Page_pics/master/posts/congruence_algorithm/DAG.png#center alt=congruence-closure-DAG class=center loading=lazy decoding=async>
</p></p>
<p>Process equality $f^3(a) = a$ gives us:</p>
<p>
<p class=markdown-image style=text-align:center>
<img src=https://raw.githubusercontent.com/BDHU/Page_pics/master/posts/congruence_algorithm/DAG_1.png#center alt=congruence-closure-DAG-2 class=center loading=lazy decoding=async>
</p></p>
<p>Recursively merging the parents results in:</p>
<p>
<p class=markdown-image style=text-align:center>
<img src=https://raw.githubusercontent.com/BDHU/Page_pics/master/posts/congruence_algorithm/DAG_2.png#center alt=congruence-closure-DAG-3 class=center loading=lazy decoding=async>
</p></p>
<p>Process equality $f^5(a) = a$ gives us:</p>
<p>
<p class=markdown-image style=text-align:center>
<img src=https://raw.githubusercontent.com/BDHU/Page_pics/master/posts/congruence_algorithm/DAG_3.png#center alt=congruence-closure-DAG-4 class=center loading=lazy decoding=async>
</p></p>
<p>Now in this step, $f^2(a)$ and $a$ are in the same congruence class, thus we will perform the same operation on their parents, processing equality $f^3(a) = f(a)$:</p>
<p>
<p class=markdown-image style=text-align:center>
<img src=https://raw.githubusercontent.com/BDHU/Page_pics/master/posts/congruence_algorithm/DAG_5.png#center alt=congruence-closure-DAG-5 class=center loading=lazy decoding=async>
</p></p>
<p>We find $f(a) \neq a$ has a conflict because node $a$&rsquo;s representative is $f(a)$, indicating they are in the same congruence class, meeting congruence relation.
Thus the formula is UNSAT.</p>
<hr class=hr-list>
<footer>
<p>© 2016-2021 <a href=https://www.bodunhu.com/>Bodun Hu</a>. All rights reserved. <a href=/blog/index.xml>Subscribe</a></p>
</footer>
</div>
</main>
</body>
</html>