<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Paper Review - Dynamic Tensor Rematerialization</title><link rel=stylesheet href=https://www.bodunhu.com/blog/css/colors-preference.min.883b7300503e483762b37ff3885f6d19d7231092664bc22f26948d5dfbf608ee.css><link rel="shortcut icon" href=https://www.bodunhu.com/blog/favicon.ico><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js async></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-108144808-1","auto"),ga("send","pageview"))</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-108144808-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><header id=header><h1><a href=https://www.bodunhu.com/blog/>std::bodun::blog</a></h1><p>PhD student at University of Texas at Austin ðŸ¤˜. Doing systems for ML.</p></header><div id=page><div id=sidebar><nav><ul class=nav><li><a href=https://www.bodunhu.com/><span>About</span></a></li><li><a href=https://twitter.com/BodunHu><span>Twitter</span></a></li><li><a href=/blog/index.xml><span>Feed</span></a></li></ul></nav></div><div id=content><article class=post><h1><a href=https://www.bodunhu.com/blog/posts/paper-review-dynamic-tensor-rematerialization/>Paper Review - Dynamic Tensor Rematerialization</a></h1><div class=post-content><p>Dynamic Tensor Rematerialization (<a href=https://arxiv.org/pdf/2006.09616.pdf>DTR</a>) treats GPU memory as a large cache, where tensors can be evicted to save memory, and recomputed if needed later.</p><p>DTR&rsquo;s eviction policy relies on the heuristic \(h\). The heuristic assigns a value \(h(t)\) to each resident tensor \(t\), approximating the cost of evicting the tensor. DTR evicts the tensor with the lowest cost based on the value of \(h\). \(h\) can factor in arbitrary metadata.</p><p>During every operator call in <a href=https://pytorch.org/>PyTorch</a>, DTR intercepts the call and performs the following tasks:</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/DTR/DTR-operator-intercept.png#center alt=DTR-operator-intercept></p><p>In short, whenever we perform an operation, we first recursively re-calculate all the non-resident tensors the current operation depends on, while evicting tensors we don&rsquo;t need until there are enough GPU space left. To decide which tensors to evict, DTR uses the tensor with the lowest value \(h\):</p><p><img src=https://cdn.jsdelivr.net/gh/BDHU/Page_Pics/posts/DTR/tensor-evict.png#center alt=tensor-evict></p><p>The heuristic \(h\) evicts tensors based on three properties: staleness, size, and compute cost. It evicts tensors that are: least recently used, takes large GPU memory space, and easy to recompute. \(H _{DTR}\) is computed as:</p><p>\[
h _{DTR}(s, m, c) (t) := \frac{c(t)}{m(t) \cdot s(t)&rsquo;}
\]</p><p>Recomputing an evicted tensor \(t\) may result in recomputing many more tensors that \(t\) recursively depends on. Thus, the paper proposes an improved heuristic to take the recursive recomputations into account (with more maintenance cost). These tensors are called <em>evicted neighborhood \(e ^{*} (t)\)</em>.</p><p>\[
h_ {DTR-improved}(s, m, c) (t) := \frac{c(t) + \sum _{u \in e ^{*} (t)} c(u)}{m(t) \cdot s(t)&rsquo;}
\]</p><p>This heuristic captures the recomputation costs for all tensors that \(t\) recursively depend on.</p></div><p class=meta>Posted on <span class=postdate>09. November 2021</span></p></article></div><footer id=footer><p class=copyright>Powered by <a href=https://gohugo.io/>Hugo</a> and the
<a href=https://github.com/bake/solar-theme-hugo>Solar</a>-theme.</p></footer></div></body></html>