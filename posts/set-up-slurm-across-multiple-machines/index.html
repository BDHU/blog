<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Set up Slurm across Multiple Machines | std::bodun::blog</title><meta name=title content="Set up Slurm across Multiple Machines"><meta name=description content="To install [Slurm](https://slurm.schedmd.com/documentation.html), we need to have admin access to the machine. This post explains how I got Slurm running in multiple Linux servers. All servers are running on Ubuntu 18.04 LTS."><meta name=keywords content="how-to,slurm,"><meta property="og:title" content="Set up Slurm across Multiple Machines"><meta property="og:description" content="To install [Slurm](https://slurm.schedmd.com/documentation.html), we need to have admin access to the machine. This post explains how I got Slurm running in multiple Linux servers. All servers are running on Ubuntu 18.04 LTS."><meta property="og:type" content="article"><meta property="og:url" content="https://www.bodunhu.com/blog/posts/set-up-slurm-across-multiple-machines/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-17T01:24:38-06:00"><meta property="og:site_name" content="std::bodun::blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Set up Slurm across Multiple Machines"><meta name=twitter:description content="To install [Slurm](https://slurm.schedmd.com/documentation.html), we need to have admin access to the machine. This post explains how I got Slurm running in multiple Linux servers. All servers are running on Ubuntu 18.04 LTS."><meta name=twitter:site content="@https://twitter.com/BodunHu"><meta itemprop=name content="Set up Slurm across Multiple Machines"><meta itemprop=description content="To install [Slurm](https://slurm.schedmd.com/documentation.html), we need to have admin access to the machine. This post explains how I got Slurm running in multiple Linux servers. All servers are running on Ubuntu 18.04 LTS."><meta itemprop=datePublished content="2021-11-16T00:00:00+00:00"><meta itemprop=dateModified content="2022-11-17T01:24:38-06:00"><meta itemprop=wordCount content="407"><meta itemprop=keywords content="how-to,slurm,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><a href=/blog/ class=title><h2>std::bodun::blog</h2></a><nav><a href=/blog/>Home</a>
<a href=/blog/posts/>Archive</a>
<a href=https://www.bodunhu.com/>About</a></nav></header><main><h1>Set up Slurm across Multiple Machines</h1><p><i><time datetime=2021-11-16 pubdate>16 Nov, 2021</time></i></p><content><p>To install <a href=https://slurm.schedmd.com/documentation.html>Slurm</a>, we need to have admin access to the machine. This post explains how I got Slurm running in multiple Linux servers. All servers are running on Ubuntu 18.04 LTS.</p><h2 id=setup-munge>Setup Munge</h2><p>First, we need to make sure the clocks, users and groups (UIDs and GIDs) are synchronized across the cluster. We need to create two users: <code>slurm</code> and <code>munge</code> across all servers.
z</p><p>Then, we install <a href=https://linux.die.net/man/7/munge>Munge</a> for authentication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apt install munge libmunge2 libmunge-dev
</span></span></code></pre></div><p>To test if munge is installed successfully:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ munge -n | unmunge | grep STATUS
</span></span><span style=display:flex><span>STATUS:           Success <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Next, we create a munge authentication key on one of the servers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ /usr/sbin/create-munge-key
</span></span></code></pre></div><p>After we generate munge authentication key, we copy the key <code>/etc/munge/munge.key</code> on that server to all other servers (overwrite the <code>/etc/munge/munge.key</code> on all other servers).</p><p>We need to setup the rights for munge accordingly on every server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ chown -R munge: /etc/munge/ /var/log/munge/ /var/lib/munge/ /run/munge/
</span></span><span style=display:flex><span>$ chmod <span style=color:#ae81ff>0700</span> /etc/munge/ /var/log/munge/ /var/lib/munge/
</span></span><span style=display:flex><span>$ chmod <span style=color:#ae81ff>0755</span> /run/munge/
</span></span></code></pre></div><p>Then, we enable and start the munge service with (remember to not use sudo when running munge):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ systemctl enable munge
</span></span><span style=display:flex><span>$ systemctl start munge
</span></span></code></pre></div><p>You can then test whether munge works properly by executing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>munge -n                    <span style=color:#75715e># Generate a credential on stdout</span>
</span></span><span style=display:flex><span>munge -n | unmunge          <span style=color:#75715e># Displays information about the MUNGE key  </span>
</span></span><span style=display:flex><span>munge -n | ssh somehost unmunge
</span></span></code></pre></div><p>If everything is setup properly, you shouldn&rsquo;t see any error messages.</p><h2 id=setup-slurm>Setup Slurm</h2><p>Use <code>apt</code> to install slurm in Ubuntu systems (make sure all nodes have the same slurm versions):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ apt install slurm-wlm
</span></span></code></pre></div><p>Next, we need to configure slurm. Since we used package manager to install slurm, the version is lower than the latest release. Thus, it&rsquo;s preferably to not use the official <a href=https://slurm.schedmd.com/configurator.html>Slurm Configuration Tool</a>. Instead, we can find the corresponding version&rsquo;s configuration tool at <code>/usr/share/doc/slurmctld/slurm-wlm-configurator.html</code>.</p><p>After filling up the required fields in the form, we copy the generated file into <code>/etc/slurm-llnl/slurm.conf</code> on all nodes. Then, you can execute <code>sinfo</code> to check all nodes status. You can also launch jobs to see if it actually works, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>srun -N2 -l /bin/hostname
</span></span></code></pre></div><p>This should print out the hostname for all the nodes in the cluster.</p><h2 id=add-gpu-support>Add GPU support</h2><p>To add GPU support, we first create a file <code>gres.conf</code> in <code>/etc/slurm-llnl/</code>. Here is an example on one node:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Name=gpu File=/dev/nvidia0
</span></span><span style=display:flex><span>Name=gpu File=/dev/nvidia1
</span></span><span style=display:flex><span>Name=gpu File=/dev/nvidia2
</span></span></code></pre></div><p>Then, we add <code>GresTypes=gpu</code> into <code>/etc/slurm-llnl/slurm.conf</code>. Next, we add the GPU information to <code>slurm.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NodeName=node1 Gres=gpu:3 State=UNKNOWN
</span></span></code></pre></div></content><p></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>