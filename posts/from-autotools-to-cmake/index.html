<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Liste - https://www.bodunhu.com/blog/">
<title>From Autotools to CMake | std::bodun::blog</title>
<meta name=description content="Personal Blog of Bodun (Edward) Hu. CS PhD student at University of Texas at Austin. Operating systems, network, heterogeneity, MLSys, anything system. UTCS">
<meta property="og:title" content="From Autotools to CMake">
<meta property="og:description" content="Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn&rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.bodunhu.com/blog/posts/from-autotools-to-cmake/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-06-21T00:00:00+00:00">
<meta property="article:modified_time" content="2021-07-07T00:48:12-05:00">
<meta itemprop=name content="From Autotools to CMake">
<meta itemprop=description content="Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn&rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version."><meta itemprop=datePublished content="2021-06-21T00:00:00+00:00">
<meta itemprop=dateModified content="2021-07-07T00:48:12-05:00">
<meta itemprop=wordCount content="402">
<meta itemprop=keywords content="other,gpu,altis,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="From Autotools to CMake">
<meta name=twitter:description content="Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn&rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version.">
<meta name=twitter:site content="@https://twitter.com/BodunHu">
<link rel=canonical href=https://www.bodunhu.com/blog/posts/from-autotools-to-cmake/>
<meta name=monetization content="$twitter.xrptipbot.com/ronaldsvilcins">
<link rel=dns-prefetch href=https://www.google-analytics.com>
<link href=https://www.google-analytics.com rel=preconnect crossorigin>
<link rel=alternate type=application/atom+xml title=std::bodun::blog href=https://www.bodunhu.com/blog/atom.xml>
<link rel=alternate type=application/json title=std::bodun::blog href=https://www.bodunhu.com/blog/feed.json>
<link rel="shortcut icon" href=/blog/images/favicon.ico type=image/x-icon>
<style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;color:#000}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}h1,h2,h3,h4,h5,strong,b{font-size:inherit;font-weight:600}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{padding:.1rem;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.hr-list-none{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}</style>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"From Autotools to CMake","headline":"From Autotools to CMake","alternativeHeadline":"","description":"Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn\u0026rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.bodunhu.com\/blog\/posts\/from-autotools-to-cmake\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"std::bodun::blog","copyrightYear":"2021","dateCreated":"2021-06-21T00:00:00.00Z","datePublished":"2021-06-21T00:00:00.00Z","dateModified":"2021-07-07T00:48:12.00Z","publisher":{"@type":"Organization","name":"std::bodun::blog","url":"https://www.bodunhu.com/blog/","logo":{"@type":"ImageObject","url":"https:\/\/www.bodunhu.com\/blog\/","width":"32","height":"32"}},"image":"https://www.bodunhu.com/blog/","url":"https:\/\/www.bodunhu.com\/blog\/posts\/from-autotools-to-cmake\/","wordCount":"402","genre":["other","gpu","altis"],"keywords":["other","gpu","altis"]}</script>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
</head>
<body>
<a class=skip-link href=#main>Skip to main</a>
<main id=main>
<div class=content>
<header>
<p style=padding:0;margin:0><a href=/blog/><b>std::bodun::blog</b></a></p>
<ul style=padding:0;margin:0>
<li><a href=https://www.bodunhu.com/>About</a></li>
</ul>
</header>
<hr class=hr-list style=padding:0;margin:0>
<h2 class=post>From Autotools to CMake</h2>
<p>Since my <a href=https://ieeexplore.ieee.org/document/9238617>paper on GPU benchmarking</a> was published, every once in a while, I got emails asking me why <a href=https://github.com/utcs-scea/altis>Altis</a> doesn&rsquo;t build on their platforms. It almost always has something to do a small <a href=https://github.com/utcs-scea/altis/blob/deprecated/config/find_cuda_libs.sh>script</a> which is responsible for finding CUDA dependencies. This script is invoked every single time <code>make</code> is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version. After enough requests piled up in my inbox, I decided enough is enough and it&rsquo;s time to ditch the autotools shenanigans for CMake.</p>
<p>When I started this project, it already had a skeleton build system based on autotools. The old build system generates automake and autoconf files. It worked fine for me on the server I used so I never bothered to make big adjustments. However, the problem soon arises when I upgrade some packages or switched to another server in our lab.</p>
<p>Because our servers are constantly being used for GPU research, the execution environment is constantly changing. Sometimes the benchmark suite would build in the morning and stop working in the afternoon because of a CUDA downgrade. My directories were filed with strange files like <code>configure.ac</code>, <code>Makefile.am</code>, <code>Makefile.in</code>, &mldr; It also uses a helper script called M4 which I still don&rsquo;t quite understand. Hand-made shell scripts are everywhere. automake has a million versions and you&rsquo;ll never know why it doesn&rsquo;t build on someone else&rsquo;s OS. Getting OptiX to work is like having a constipation because the LD flag doesn&rsquo;t get placed in the right location.</p>
<p>Switching to CMake was a lot smoother than I anticipated. I took about two days to rewrite the entire build system from scratch. Contrary to autotools, CMake&rsquo;s syntax is easier to learn. The terminal output is easier to read by default, instead of throwing every single detail to my face. And, it&rsquo;s colored! Debugging build issues no longer takes multiple hours.</p>
<p>Perhaps the best part is, since CMake 3.8, CUDA is natively supported. Compiling <code>.cu</code> files is as easy as adding <code>CUDA</code> as the project&rsquo;s LANGUAGES. That alone should be the reason to use CMake if there&rsquo;s anything CUDA related. The only caveat is there&rsquo;s a small difference between how CMake handle CUDA architecture flags in different versions. Since CMake 3.16, <code>CMAKE_CUDA_ARCHITECTURES</code> is introduced. Older versions still requires <code>find_package(CUDA)</code> to set CUDA compilation flags though.</p>
<hr class=hr-list>
<footer>
<p>© 2016-2021 <a href=https://www.bodunhu.com/>Bodun Hu</a>. All rights reserved. <a href=/blog/index.xml>Subscribe</a></p>
</footer>
</div>
</main>
</body>
</html>