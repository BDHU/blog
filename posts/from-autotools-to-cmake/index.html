<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Personal Blog of Bodun (Edward) Hu. CS PhD student at University of Texas at Austin. Operating systems, network, heterogeneity, MLSys, anything system. UTCS">
<link rel="shortcut icon" href=https://www.bodunhu.com/blog/favicon.ico>
<link rel=stylesheet href=/blog/css/style.min.css>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<title>From Autotools to CMake</title>
</head>
<body><header id=banner>
<h2><a href=https://www.bodunhu.com/blog/>std::bodun::blog</a></h2>
<nav>
<ul>
<li>
<a href=/blog/posts/ title=posts>archive</a>
</li><li>
<a href=https://www.bodunhu.com/ title=about>about</a>
</li>
</ul>
</nav>
</header>
<main id=content>
<article>
<header id=post-header>
<h1>From Autotools to CMake</h1>
<div>
Updated <time>July 7, 2021</time>
</div>
</header><p>Since my <a href=https://ieeexplore.ieee.org/document/9238617>paper on GPU benchmarking</a> was published, every once in a while, I got emails asking me why <a href=https://github.com/utcs-scea/altis>Altis</a> doesn&rsquo;t build on their platforms. It almost always has something to do a small <a href=https://github.com/utcs-scea/altis/blob/deprecated/config/find_cuda_libs.sh>script</a> which is responsible for finding CUDA dependencies. This script is invoked every single time <code>make</code> is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version. After enough requests piled up in my inbox, I decided enough is enough and it&rsquo;s time to ditch the autotools shenanigans for CMake.</p>
<p>When I started this project, it already had a skeleton build system based on autotools. The old build system generates automake and autoconf files. It worked fine for me on the server I used so I never bothered to make big adjustments. However, the problem soon arises when I upgrade some packages or switched to another server in our lab.</p>
<p>Because our servers are constantly being used for GPU research, the execution environment is constantly changing. Sometimes the benchmark suite would build in the morning and stop working in the afternoon because of a CUDA downgrade. My directories were filed with strange files like <code>configure.ac</code>, <code>Makefile.am</code>, <code>Makefile.in</code>, &mldr; It also uses a helper script called M4 which I still don&rsquo;t quite understand. Hand-made shell scripts are everywhere. automake has a million versions and you&rsquo;ll never know why it doesn&rsquo;t build on someone else&rsquo;s OS. Getting OptiX to work is like having a constipation because the LD flag doesn&rsquo;t get placed in the right location.</p>
<p>Switching to CMake was a lot smoother than I anticipated. I took about two days to rewrite the entire build system from scratch. Contrary to autotools, CMake&rsquo;s syntax is easier to learn. The terminal output is easier to read by default, instead of throwing every single detail to my face. And, it&rsquo;s colored! Debugging build issues no longer takes multiple hours.</p>
<p>Perhaps the best part is, since CMake 3.8, CUDA is natively supported. Compiling <code>.cu</code> files is as easy as adding <code>CUDA</code> as the project&rsquo;s LANGUAGES. That alone should be the reason to use CMake if there&rsquo;s anything CUDA related. The only caveat is there&rsquo;s a small difference between how CMake handle CUDA architecture flags in different versions. Since CMake 3.16, <code>CMAKE_CUDA_ARCHITECTURES</code> is introduced. Older versions still requires <code>find_package(CUDA)</code> to set CUDA compilation flags though.</p>
</article>
</main><footer id=footer>
<p>Copyright Â© 2016-2021 Bodun Hu. All rights reserved.</p>
</footer></body>
</html>