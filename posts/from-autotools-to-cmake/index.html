<!doctype html><html lang=en-us><head><title>From Autotools to CMake | std::bodun::blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn&rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version."><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/blog/css/style.css><link rel="shortcut icon" href=/blog/images/favicon.ico type=image/x-icon><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-108144808-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="From Autotools to CMake"><meta name=twitter:description content="Since my paper on GPU benchmarking was published, every once in a while, I got emails asking me why Altis doesn&rsquo;t build on their platforms. It almost always has something to do a small script which is responsible for finding CUDA dependencies. This script is invoked every single time make is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version."><meta name=twitter:site content="@https://twitter.com/BodunHu"><script>document.getElementById("scroll-to-top").addEventListener("click",function(){window.scrollTo({top:0,left:0,behavior:'smooth'})})</script></head><body><nav class=navigation><a href=/blog/><span class=arrow>←</span>Home</a>
<a href=/blog/posts>Archive</a>
<a href=/blog/tags>Tags</a>
<a href=https://www.bodunhu.com/>About</a>
<a class=button href=https://www.bodunhu.com/blog/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>From Autotools to CMake</h1><div class=tip><time datetime="2021-06-21 00:00:00 +0000 UTC">Jun 21, 2021</time>
<span class=split>·</span>
<span>2 minute read</span></div><div class=content><p>Since my <a href=https://ieeexplore.ieee.org/document/9238617 target=_blank rel=noopener>paper on GPU benchmarking</a> was published, every once in a while, I got emails asking me why <a href=https://github.com/utcs-scea/altis target=_blank rel=noopener>Altis</a> doesn&rsquo;t build on their platforms. It almost always has something to do a small <a href=https://github.com/utcs-scea/altis/blob/deprecated/config/find_cuda_libs.sh target=_blank rel=noopener>script</a> which is responsible for finding CUDA dependencies. This script is invoked every single time <code>make</code> is executed. For some reason, the regular expression in the script sometimes breaks randomly, depending on the Linux distro, the kernel version, the host architecture, or even the CUDA version. After enough requests piled up in my inbox, I decided enough is enough and it&rsquo;s time to ditch the autotools shenanigans for CMake.</p><p>When I started this project, it already had a skeleton build system based on autotools. The old build system generates automake and autoconf files. It worked fine for me on the server I used so I never bothered to make big adjustments. However, the problem soon arises when I upgrade some packages or switched to another server in our lab.</p><p>Because our servers are constantly being used for GPU research, the execution environment is constantly changing. Sometimes the benchmark suite would build in the morning and stop working in the afternoon because of a CUDA downgrade. My directories were filed with strange files like <code>configure.ac</code>, <code>Makefile.am</code>, <code>Makefile.in</code>, &mldr; It also uses a helper script called M4 which I still don&rsquo;t quite understand. Hand-made shell scripts are everywhere. automake has a million versions and you&rsquo;ll never know why it doesn&rsquo;t build on someone else&rsquo;s OS. Getting OptiX to work is like having a constipation because the LD flag doesn&rsquo;t get placed in the right location.</p><p>Switching to CMake was a lot smoother than I anticipated. I took about two days to rewrite the entire build system from scratch. Contrary to autotools, CMake&rsquo;s syntax is easier to learn. The terminal output is easier to read by default, instead of throwing every single detail to my face. And, it&rsquo;s colored! Debugging build issues no longer takes multiple hours.</p><p>Perhaps the best part is, since CMake 3.8, CUDA is natively supported. Compiling <code>.cu</code> files is as easy as adding <code>CUDA</code> as the project&rsquo;s LANGUAGES. That alone should be the reason to use CMake if there&rsquo;s anything CUDA related. The only caveat is there&rsquo;s a small difference between how CMake handle CUDA architecture flags in different versions. Since CMake 3.16, <code>CMAKE_CUDA_ARCHITECTURES</code> is introduced. Older versions still requires <code>find_package(CUDA)</code> to set CUDA compilation flags though.</p></div><div class=tags><a href=https://www.bodunhu.com/blog/tags/other>other</a>
<a href=https://www.bodunhu.com/blog/tags/gpu>gpu</a>
<a href=https://www.bodunhu.com/blog/tags/altis>altis</a></div><div id=comment><script src=https://utteranc.es/client.js repo=BDHU/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></section></main><footer id=footer><div class=copyright>©
2016-2021
<a href=https://www.bodunhu.com/>Bodun Hu</a>. All rights reserved.</div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-cactus-plus>nodejh</a></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link><i class="fa fa-chevron-up"></i></button></a></footer></body></html>